
<div class="wrapper">
    

    <div class="main-panel expand">
        
        <!-- TODO Add Footer Partial -->
        <%= render partial: "users/navbar" %>


        <div class="content">
            <div class="container-fluid">




                <div class="row">
                      <div class="col-md-7">
                        <div class="card">
                            <div class="header">
                                <h4 class="title">New Company</h4>
                            </div>
                            <div class="content">

                                <!-- form start here  -->
                                <form method="post" enctype="multipart/form-data" action="/companies">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label>Company Name</label>
                                                <input type="text" class="form-control border-input"  placeholder="Company" name="name">
                                            </div>
                                        </div>
    
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label >Tags</label>
                                                <input type="text" class="form-control border-input"  placeholder="Tags" name="tags">
                                            </div>
                                        </div>

                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label >Subdomain</label>
                                                <input type="text" class="form-control border-input"  placeholder="subdomain.dropque.com" name="subdomain">
                                            </div>
                                        </div>
                                    </div>

            

                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label>Address</label>
                                                <input type="text" class="form-control border-input" placeholder="Company Address" class="address" name="address">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>City</label>
                                                <input type="text" class="form-control border-input" placeholder="City" name="city">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>Country</label>
                                                <input type="text" class="form-control border-input" placeholder="Country"  >
                                            </div>
                                        </div>
                                        
                                    </div>

                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label>Description</label>
                                                <textarea rows="5" class="form-control border-input" placeholder="Description" name="description">
                                            </textarea> 
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label for="file-upload" class="btn custom-upload">
                                                    <input id="file-upload" type="file" name="image">
                                                    click to attach company's Image

                                                </label>
                                                      
                                            </div>
                                        </div>
                                    </div>

                                    <!-- add csrf token -->
                                    <%= tag(:input, :type => "hidden", :name => request_forgery_protection_token.to_s, :value => form_authenticity_token) %> 

                                    <!-- hiddden user's id -->
                                    <input type="text" name="user_id" value="<%= @user.id %>" hidden >
                                    <!-- hiddent stringify emails for collaboartions -->
                                    <input type="text" id="collaborate-json" name="collaborators_list"  hidden>

                                    
                                    
                                    <!-- <div class="text-center">
                                        <button type="submit" class="btn btn-info btn-fill btn-wd"> Create Company </button>
                                    </div>
                                    <div class="clearfix"></div> -->
                               
                            </div>
                        </div>
                       </div>

                       <div class="col-md-5">
                        <div class="card">
                            <div class="header">
                                <h4 class="title float-left">Add Collaborators</h4>
                                <btn id="add-collaborator" class='btn add-collaborator'><i class='ti-plus'></i></btn>
                                <br><br>
                            </div>
                            <div class="content">

                                <!-- <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label>Super Admin</label><br>
                                            <label>Admin</label><br>
                                            <label>User</label><br>
                                        </div>
                                        
                                    </div>

                                 </div> -->
                                    <div id="collaborator-content" >
                                    <!-- <div class="row">
                                        <div class="col-md-8">
                                            <div class="form-group">
                                                <label>Email</label>
                                                <input type="text" class="form-control border-input"  placeholder="Email" name="name">
                                            </div>
                                        </div>
    
                                        <div class="col-md-4">
                                            <div class="form-group">
                                            <label >Admin Status</label>
                                            <div class="cd-filter-block"> 
                                                <select>
                                                    <option value="1"> super admin </option>
                                                    <option value="2"> admin</option>
                                                    <option value="3"> user  </option>
                                                </select>
                                            </div>

                                          </div>
                                        </div>

                                    </div> -->
                                    </div>
                                    
                                    <div class="text-center">
                                        <button  id="create-company" type="submit" class="btn btn-info btn-fill btn-wd"> Create Company </button>
                                    </div>
                                    <div class="clearfix"></div>
                                </form>
                            </div>
                        </div>
                       </div>
                    </div>

            	


           


               
                
            </div>
        </div>


        <!-- TODO Add Footer Partial -->
        <%= render partial: "users/footer" %>

    </div>
</div>



<!-- javascript for this particular page -->
<script> 

    $("#create-company").click(function(event){

        jsonObj = [];

         $("#collaborator-content").find(".row").each(function(index) {
             var emailObject = $(this).find("input");
             var email = emailObject.get(0).value ;
             var statusObject = $(this).find("option:selected");
             var status = statusObject.get(0).value;
             
             if (!email || !status){
                // check if email or status is empty
                showMessage('top','right', "Email cannot be empty", 4);
                event.preventDefault();

             } else{
                
                collaborateItem = {}
                collaborateItem["email"] = email;
                collaborateItem["status"] = status ;
                jsonObj.push(collaborateItem);
             }
             
        });

            $("#collaborate-json").val(JSON.stringify(jsonObj));
            console.log(JSON.stringify(jsonObj));

    });

    
    $("#add-collaborator").click(function(){
        console.log("working");
        $("#collaborator-content").append(
        "<div class='row'>"+
            "<div class='col-md-6'>" +
            "<div class='form-group'>"+
            "<input type='text' class='form-control border-input'  placeholder='email'>"+
            "</div>"+
            "</div>"+
            "<div class='col-md-6'>"+
                "<select class='btn box-shape-1' >"+
                    "<option value='1'> super admin </option>"+
                    "<option value='2'> admin</option>"+
                    "<option value='3'> user  </option>"+
                "</select>"+
                "<btn class='btn box-shape width-perfect remove-new-collaborator' >"+
                "<i class='ti-close'>"+
                "</btn>"+
            "</div>"+
    
        "</div>"
            );
    
    });


    //  remove added collaborators
     $("#collaborator-content").on("click", ".remove-new-collaborator", function(){
        $(this).parents('div.row')[0].remove();
    });


</script>


